<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Go Todo System</title>
    <style>
        :root { --primary: #3b82f6; --bg: #f3f4f6; --card: #ffffff; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background-color: var(--bg); color: #1f2937; }
        h1 { text-align: center; color: #111827; }
        .container { display: grid; gap: 20px; }
        .card { background: var(--card); padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .card h3 { margin-top: 0; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px; font-size: 1.1rem; }
        
        /* Inputs & Buttons */
        .input-group { display: flex; gap: 10px; }
        input { flex: 1; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 1rem; }
        button { cursor: pointer; padding: 10px 15px; border: none; border-radius: 6px; background-color: var(--primary); color: white; font-weight: 600; transition: 0.2s; }
        button:hover { opacity: 0.9; }
        button.danger { background-color: #ef4444; }
        button.secondary { background-color: #6b7280; }

        /* Todo List */
        .todo-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid #f3f4f6; }
        .todo-item:last-child { border-bottom: none; }
        .todo-content { cursor: pointer; flex: 1; }
        .done { text-decoration: line-through; color: #9ca3af; }
        
        /* Logs */
        #log { background: #1f2937; color: #10b981; padding: 15px; height: 200px; overflow-y: auto; border-radius: 8px; font-family: monospace; font-size: 0.9rem; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>ğŸ¹ Go Todo System</h1>

    <div class="container">
        <div class="card">
            <h3>â• í•  ì¼ ì¶”ê°€ (POST)</h3>
            <div class="input-group">
                <input type="text" id="taskInput" placeholder="í•  ì¼ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: Docker ê³µë¶€í•˜ê¸°)">
                <button onclick="addTodo()">ì¶”ê°€</button>
            </div>
        </div>

        <div class="card">
            <h3>âš¡ ê³ ê¸‰ ê¸°ëŠ¥ (Concurrency)</h3>
            <div class="input-group">
                <button class="secondary" onclick="getDashboard()">ğŸ“Š ëŒ€ì‹œë³´ë“œ ì¡°íšŒ (Parallel)</button>
                <button class="secondary" onclick="requestReport()">ğŸ“¨ ë¦¬í¬íŠ¸ ìš”ì²­ (Async)</button>
                <a href="/swagger/index.html" target="_blank" style="margin-left: auto;">
                    <button style="background-color: #059669;">ğŸ“˜ API ë¬¸ì„œ (Swagger)</button>
                </a>
            </div>
        </div>

        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h3>ğŸ“ í•  ì¼ ëª©ë¡</h3>
                <button class="secondary" style="padding: 5px 10px; font-size: 0.8rem;" onclick="loadTodos()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
            </div>
            <div id="todoList"></div>
        </div>

        <div class="card">
            <h3>ğŸ–¥ï¸ ì‹¤ì‹œê°„ ì‘ë‹µ ë¡œê·¸</h3>
            <div id="log"></div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8080';

        function log(msg) {
            const logBox = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            logBox.innerHTML += `[${time}] ${msg}\n`;
            logBox.scrollTop = logBox.scrollHeight;
        }

        // 1. ëª©ë¡ ì¡°íšŒ (Standard Response íŒŒì‹±)
        async function loadTodos() {
            try {
                const res = await fetch(`${API_URL}/todos`);
                const response = await res.json();
                
                // âœ¨ í‘œì¤€ ì‘ë‹µ ì²˜ë¦¬: response.dataê°€ ì‹¤ì œ ë°°ì—´
                const todos = response.data || []; 

                const listDiv = document.getElementById('todoList');
                listDiv.innerHTML = '';
                
                if (todos.length === 0) {
                    listDiv.innerHTML = '<div style="text-align:center; color:#ccc; padding:20px;">í•  ì¼ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                    return;
                }

                todos.forEach(todo => {
                    const div = document.createElement('div');
                    div.className = 'todo-item';
                    div.innerHTML = `
                        <span class="todo-content ${todo.done ? 'done' : ''}" onclick="toggleTodo(${todo.id})">
                            [${todo.id}] ${todo.task}
                        </span>
                        <button class="danger" onclick="deleteTodo(${todo.id})">ì‚­ì œ</button>
                    `;
                    listDiv.appendChild(div);
                });
                log(`âœ… ëª©ë¡ ë¡œë“œ ì™„ë£Œ: ${todos.length}ê±´`);
            } catch (e) { log('âŒ ë¡œë“œ ì‹¤íŒ¨: ' + e); }
        }

        // 2. ì¶”ê°€
        async function addTodo() {
            const input = document.getElementById('taskInput');
            if (!input.value) return;
            try {
                const res = await fetch(`${API_URL}/todos`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ task: input.value })
                });
                const response = await res.json(); // { code: 201, message: "Created", data: {...} }
                
                if (response.code === 201) {
                    log(`âœ¨ ì¶”ê°€ ì„±ê³µ: ${response.data.task}`);
                    input.value = '';
                    loadTodos();
                } else {
                    log(`âš ï¸ ì¶”ê°€ ì‹¤íŒ¨: ${response.message}`);
                }
            } catch (e) { log('âŒ ì—ëŸ¬ ë°œìƒ: ' + e); }
        }

        // 3. ì™„ë£Œ í† ê¸€
        async function toggleTodo(id) {
            try {
                const res = await fetch(`${API_URL}/todos/${id}`, { method: 'PATCH' });
                const response = await res.json();
                // PATCH ì‘ë‹µë„ WebResponseì¸ì§€, Rawì¸ì§€ì— ë”°ë¼ ë‹¤ë¥´ì§€ë§Œ
                // ë³´í†µ ìƒíƒœ ì½”ë“œ 200ì´ë©´ ì„±ê³µìœ¼ë¡œ ê°„ì£¼
                if (res.ok) {
                   log(`ğŸ”„ ìƒíƒœ ë³€ê²½ ì™„ë£Œ (ID: ${id})`);
                   loadTodos();
                } else {
                   log(`âš ï¸ ë³€ê²½ ì‹¤íŒ¨: ${response.message || 'Unknown Error'}`);
                }
            } catch (e) { log('âŒ ì—ëŸ¬ ë°œìƒ: ' + e); }
        }

        // 4. ì‚­ì œ
        async function deleteTodo(id) {
            if(!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
            try {
                const res = await fetch(`${API_URL}/todos/${id}`, { method: 'DELETE' });
                const response = await res.json();
                log(`ğŸ—‘ï¸ ì‚­ì œ ê²°ê³¼: ${response.message}`);
                loadTodos();
            } catch (e) { log('âŒ ì—ëŸ¬ ë°œìƒ: ' + e); }
        }

        // 5. ëŒ€ì‹œë³´ë“œ
        async function getDashboard() {
            log('â³ ëŒ€ì‹œë³´ë“œ ë°ì´í„° ìš”ì²­ ì¤‘...');
            const start = Date.now();
            try {
                const res = await fetch(`${API_URL}/dashboard`);
                const response = await res.json();
                const elapsed = Date.now() - start;
                log(`ğŸ“Š ëŒ€ì‹œë³´ë“œ ìˆ˜ì‹  (${elapsed}ms): \n${JSON.stringify(response.data, null, 2)}`);
            } catch (e) { log('âŒ ëŒ€ì‹œë³´ë“œ ìš”ì²­ ì‹¤íŒ¨: ' + e); }
        }

        // 6. ë¦¬í¬íŠ¸
        async function requestReport() {
            try {
                const res = await fetch(`${API_URL}/reports`, { method: 'POST' });
                const response = await res.json();
                log(`ğŸ“¨ ë¦¬í¬íŠ¸ ìš”ì²­: ${response.message}`);
            } catch (e) { log('âŒ ë¦¬í¬íŠ¸ ìš”ì²­ ì‹¤íŒ¨: ' + e); }
        }

        // ì´ˆê¸° ì‹¤í–‰
        loadTodos();
    </script>
</body>
</html>