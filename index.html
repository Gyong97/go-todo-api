<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Go Todo Manager</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 20px auto; padding: 20px; }
        .section { border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; border-radius: 8px; }
        button { cursor: pointer; padding: 5px 10px; }
        input { padding: 5px; width: 200px; }
        code { background: #f4f4f4; padding: 2px 5px; }
        #log { background: #333; color: #fff; padding: 10px; height: 200px; overflow-y: scroll; white-space: pre-wrap; }
        .todo-item { display: flex; justify-content: space-between; border-bottom: 1px solid #eee; padding: 5px 0; }
        .done { text-decoration: line-through; color: #888; }
    </style>
</head>
<body>
    <h1>ğŸ¹ Go Todo API Tester</h1>

    <div class="section">
        <h3>â• í•  ì¼ ì¶”ê°€ (POST /todos)</h3>
        <input type="text" id="taskInput" placeholder="í•  ì¼ì„ ì…ë ¥í•˜ì„¸ìš”">
        <button onclick="addTodo()">ì¶”ê°€</button>
    </div>

    <div class="section">
        <h3>ğŸ“Š ëŒ€ì‹œë³´ë“œ & ë¦¬í¬íŠ¸</h3>
        <button onclick="getDashboard()">ëŒ€ì‹œë³´ë“œ ì¡°íšŒ (Parallel)</button>
        <button onclick="requestReport()">ë¦¬í¬íŠ¸ ìƒì„± ìš”ì²­ (Async)</button>
    </div>

    <div class="section">
        <h3>ğŸ“ í•  ì¼ ëª©ë¡ (GET /todos) <button onclick="loadTodos()">ìƒˆë¡œê³ ì¹¨</button></h3>
        <div id="todoList"></div>
    </div>

    <div class="section">
        <h3>ğŸ–¥ï¸ ì„œë²„ ì‘ë‹µ ë¡œê·¸</h3>
        <div id="log"></div>
    </div>

    <script>
        const API_URL = 'http://localhost:8080';

        // ë¡œê·¸ ì¶œë ¥ í•¨ìˆ˜
        function log(msg) {
            const logBox = document.getElementById('log');
            logBox.innerText += `[${new Date().toLocaleTimeString()}] ${msg}\n`;
            logBox.scrollTop = logBox.scrollHeight;
        }

        // 1. ëª©ë¡ ì¡°íšŒ
        async function loadTodos() {
            try {
                const res = await fetch(`${API_URL}/todos`);
                const todos = await res.json();
                const listDiv = document.getElementById('todoList');
                listDiv.innerHTML = '';
                
                todos.forEach(todo => {
                    const div = document.createElement('div');
                    div.className = 'todo-item';
                    div.innerHTML = `
                        <span class="${todo.done ? 'done' : ''}" onclick="toggleTodo(${todo.id})">
                            [${todo.id}] ${todo.task}
                        </span>
                        <button onclick="deleteTodo(${todo.id})">ì‚­ì œ</button>
                    `;
                    listDiv.appendChild(div);
                });
                log(`ëª©ë¡ ë¡œë“œ ì™„ë£Œ (${todos.length}ê±´)`);
            } catch (e) { log('âŒ ë¡œë“œ ì‹¤íŒ¨: ' + e); }
        }

        // 2. ì¶”ê°€
        async function addTodo() {
            const input = document.getElementById('taskInput');
            if (!input.value) return;
            try {
                const res = await fetch(`${API_URL}/todos`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ task: input.value })
                });
                const data = await res.json();
                log(`ì¶”ê°€ ì„±ê³µ: ${JSON.stringify(data)}`);
                input.value = '';
                loadTodos(); // ëª©ë¡ ê°±ì‹ 
            } catch (e) { log('âŒ ì¶”ê°€ ì‹¤íŒ¨: ' + e); }
        }

        // 3. ì™„ë£Œ í† ê¸€
        async function toggleTodo(id) {
            await fetch(`${API_URL}/todos/${id}`, { method: 'PATCH' });
            loadTodos();
        }

        // 4. ì‚­ì œ
        async function deleteTodo(id) {
            await fetch(`${API_URL}/todos/${id}`, { method: 'DELETE' });
            loadTodos();
        }

        // 5. ëŒ€ì‹œë³´ë“œ (ë³‘ë ¬ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸)
        async function getDashboard() {
            log('â³ ëŒ€ì‹œë³´ë“œ ë°ì´í„° ìš”ì²­ ì¤‘...');
            const start = Date.now();
            const res = await fetch(`${API_URL}/dashboard`);
            const data = await res.json();
            const elapsed = Date.now() - start;
            log(`âœ… ëŒ€ì‹œë³´ë“œ ìˆ˜ì‹  (${elapsed}ms): \n${JSON.stringify(data, null, 2)}`);
        }

        // 6. ë¦¬í¬íŠ¸ (ë¹„ë™ê¸° ì²˜ë¦¬ í…ŒìŠ¤íŠ¸)
        async function requestReport() {
            const res = await fetch(`${API_URL}/reports`, { method: 'POST' });
            const data = await res.json();
            log(`ğŸ“¨ ë¦¬í¬íŠ¸ ìš”ì²­ ê²°ê³¼: ${data.message}`);
        }

        // ì´ˆê¸° ë¡œë“œ
        loadTodos();
    </script>
</body>
</html>