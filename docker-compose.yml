services:
  # ğŸš¦ ë¡œë“œ ë°¸ëŸ°ì„œ
  nginx:
    image: nginx:latest
    ports:
      - "80:80" # ë¸Œë¼ìš°ì €ì—ì„œ http://localhost ë¡œ ì ‘ì†
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - app-1
      - app-2

  # ğŸ¹ ì„œë²„ 1 (Active í›„ë³´)
  app-1:
    build: 
      context: .
      target: builder
    hostname: server-1
    environment:
      - SERVER_PORT=:8080
      - INITIAL_ROLE=active  # ğŸ‘ˆ âœ¨ ë„ˆëŠ” ë°˜ì¥ì´ì•¼ (Active)
    volumes:
      - ./data:/data
      - ./config.yaml:/app/config.yaml
      - ./static:/app/static
      - ./:/app
    command: ["air", "-c", ".air.toml"]

  app-2:
    build: .
    hostname: server-2
    environment:
      - SERVER_PORT=:8080
      - INITIAL_ROLE=standby # ğŸ‘ˆ âœ¨ ë„ˆëŠ” ë¶€ë°˜ì¥ì´ì•¼ (Standby)
    volumes:
      - ./data:/data
      - ./config.yaml:/app/config.yaml
      - ./static:/app/static
    command: ["./main"]
